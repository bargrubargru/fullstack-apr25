var GDPRMsg=function(){function b(){fetch("https://mass.mako.co.il/ClicksStatistics/isAbroad.jsp").then(function(a){return a.text()}).then(function(a){console.log("isAbroad: ",a);sessionStorage.setItem("mako_is_abroad",a)})}-1<location.hostname.indexOf("mobileapp")||document.addEventListener("DOMContentLoaded",function(){null===sessionStorage.getItem("mako_is_abroad")&&b()})}(),P13N={reordering:{},ab_testing:{},DAY:864E5,HOUR:36E5,ALGORITHM_VERSION:24,MIN_TIME_FOR_LONG_IMPRESSION:10,NUMBER_OF_DAYS_TO_SAVE_DATA:90,
MAX_NUMBER_OF_ITEMS_TO_SAVE:5E4,MIN_SCORE_FOR_REORDERING:5,MIN_SCORE_FOR_REORDERING_PASSED:!1,PAUSE_DAYS_BETWEEN_SCORE_CALCULATIONS:-1E3,NUMBER_OF_DAYS_CONSIDERED_NEW_IMPRESSION:30,CONTROL_GROUP_PROMIL:100,REORDERING_GROUP_PROMIL:900},isInControlGroup=P13N.CONTROL_GROUP_PROMIL>localStorage.p13n_user_group;P13N.SESSION_TIME=18E5;P13N.FORMULA_MULTIPLIER_TOTAL_NUMBER_OF_VIEWS=1;P13N.FORMULA_MULTIPLIER_LONG_VIEWS=0;P13N.FORMULA_MULTIPLIER_OLD_VIEWS_PUNISHMENT=-1;
var p13nurl="",p13nmatches="",p13ndomain="",p13nsubdomain="";try{p13nurl=window.location.href,p13ndomain=(p13nmatches=p13nurl.match(/^https?:\/\/([^\/?#]+)(?:[\/?#]|$)/i))&&p13nmatches[1],p13nsubdomain=p13ndomain.substr(0,p13ndomain.indexOf("."))}catch(b){}
try{localStorage.p13n_user_group||(localStorage.p13n_user_group=Math.floor(1E3*Math.random())),localStorage.user_is_participating_in_p13n=localStorage.p13n_user_group>P13N.CONTROL_GROUP_PROMIL&&localStorage.p13n_user_group<P13N.CONTROL_GROUP_PROMIL+P13N.REORDERING_GROUP_PROMIL?1:0}catch(b){}var request=new XMLHttpRequest;request.open("GET","https://rcs.mako.co.il/js/p13n_data.json",!1);request.send(null);P13N.reordering.sections=200===request.status?JSON.parse(request.responseText):[];
for(var i=0;i<P13N.reordering.sections.length;i++){var section=P13N.reordering.sections[i];if(section.timeframe&&section.pinned_to_position&&section.pinned_to_position.hasOwnProperty(p13nsubdomain)){var fromDay=section.timeframe.fromDay,fromTime=section.timeframe.fromTime,toDay=section.timeframe.toDay,toTime=section.timeframe.toTime,pinned_to_position=section.pinned_to_position,now=new Date,day=now.getUTCDay(),hour=now.getUTCHours(),now_int=100*day+hour,from_int=100*fromDay+fromTime,to_int=100*toDay+
toTime,isSectionActive=!1;to_int<from_int?(to_int+=700,now_int<from_int&&(now_int+=700),now_int>=from_int&&now_int<=to_int&&(isSectionActive=!0)):now_int<=to_int&&now_int>=from_int&&(isSectionActive=!0);if(!isSectionActive){for(var j=0;j<P13N.reordering.sections.length;j++){var otherSection=P13N.reordering.sections[j];if(otherSection.pinned_to_position)for(var domain in pinned_to_position)pinned_to_position.hasOwnProperty(domain)&&otherSection.pinned_to_position.hasOwnProperty(domain)&&otherSection.pinned_to_position[domain]>
pinned_to_position[domain]&&--otherSection.pinned_to_position[domain]}delete section.pinned_to_position}}}P13N.debug=function(b){};
P13N.reordering.get_reporting_parameters=function(){var b=[];if(localStorage.section_order)for(var a=JSON.parse(localStorage.section_order),c=0;c<a.length;c++){var d=a[c];b.push(encodeURIComponent(d.name)+":"+d.position)}b={a_ver:P13N.ALGORITHM_VERSION,is_p:1==localStorage.user_is_participating_in_p13n||isInControlGroup?1:0,cg_p:isInControlGroup?1:0,user_group:localStorage.p13n_user_group,section_scores:encodeURIComponent(localStorage.section_scores),order:b.join(",")};return JSON.stringify(b)};
P13N.reordering.get_section_order=function(){localStorage.user_is_participating_in_p13n_test_group=0;localStorage.user_is_participating_in_p13n_cg=isInControlGroup?1:0;var b=P13N.reordering.get_section_scores(),a=[],c=[],d=[],f=0,e={},g={},h;for(h in b)if(e=P13N.reordering.getSection(h))g=P13N.reordering.getSectionPinnedAfter(e.name),e.pinned_to_position&&e.pinned_to_position.hasOwnProperty(p13nsubdomain)||e.pinned_after_ordering&&e.pinned_after_ordering.hasOwnProperty(p13nsubdomain)||(g?(a.push({name:h,
score:b[h]+b[g.name]}),a.push({name:g.name,score:b[h]+b[g.name]+.5})):a.push({name:h,score:b[h]}));b=[];for(g=g=0;g<P13N.reordering.sections.length;g++)(e=P13N.reordering.sections[g])&&e.pinned_to_position&&e.pinned_to_position.hasOwnProperty(p13nsubdomain)&&(f++,c.push(e),d.push({position:e.pinned_to_position[p13nsubdomain],name:e.name}),b[e.pinned_to_position[p13nsubdomain]]=1);a.sort(function(k,l){return l.score-k.score});for(g=c=0;g<f+a.length;g++)b[g]||(a[c]&&d.push({position:g,name:a[c].name}),
c++);d.sort(function(k,l){return k.position-l.position});P13N.debug(JSON.stringify(d));localStorage.section_order=JSON.stringify(d);return isInControlGroup||0==localStorage.user_is_participating_in_p13n?"[]":JSON.stringify(d)};
P13N.reordering.getSectionPinnedAfter=function(b){for(var a=0;a<P13N.reordering.sections.length;a++)if((section=P13N.reordering.sections[a])&&section.pinned_after_ordering&&section.pinned_after_ordering.hasOwnProperty(p13nsubdomain)&&section.pinned_after_ordering[p13nsubdomain]===b)return section};P13N.reordering.getSectionPinnedBefore=function(b){if((b=P13N.reordering.getSection(b))&&b.pinned_after_ordering&&b.pinned_after_ordering.hasOwnProperty(p13nsubdomain))return P13N.reordering.getSection(b.pinned_after_ordering[p13nsubdomain])};
P13N.reordering.get_section_scores=function(){var b=(new Date).getTime();if(localStorage.section_scores){var a=JSON.parse(localStorage.section_scores);P13N.debug(JSON.stringify(localStorage.section_scores));if(b<a.creation_time+P13N.PAUSE_DAYS_BETWEEN_SCORE_CALCULATIONS*P13N.DAY)return P13N.debug("cached section scores are valid (less than "+P13N.PAUSE_DAYS_BETWEEN_SCORE_CALCULATIONS+" days old)"),a}a=localStorage.impressions?JSON.parse(localStorage.impressions):[];"[object Array]"!==Object.prototype.toString.call(a)&&
(a=JSON.parse(a));for(var c={},d=0;d<a.length;d++){var f=P13N.reordering.Impression.fromString(a[d]);c[f.section]||(c[f.section]=[]);c[f.section].push(f)}a={};d=0;for(var e in c)if(c.hasOwnProperty(e)){for(var g=P13N.reordering.getSection(e),h=c[e].length,k=0,l=0,m=0;m<c[e].length;m++)f=c[e][m],f.length_of_stay>1E3*P13N.MIN_TIME_FOR_LONG_IMPRESSION&&k++,f.start_time>b-P13N.NUMBER_OF_DAYS_CONSIDERED_NEW_IMPRESSION*P13N.DAY&&l++;f=P13N.FORMULA_MULTIPLIER_TOTAL_NUMBER_OF_VIEWS*h+P13N.FORMULA_MULTIPLIER_LONG_VIEWS*
k+P13N.FORMULA_MULTIPLIER_OLD_VIEWS_PUNISHMENT*(0===l?1:0);h=0;(k=P13N.reordering.getSectionPinnedAfter(e))&&c[k.name]&&(h=c[k.name].length);(k=P13N.reordering.getSectionPinnedBefore(e))&&c[k.name]&&(h=c[k.name].length);if(f+h>P13N.MIN_SCORE_FOR_REORDERING||g&&g.pinned_to_position&&g.pinned_to_position.hasOwnProperty(p13nsubdomain))d++,f>P13N.MIN_SCORE_FOR_REORDERING&&(P13N.MIN_SCORE_FOR_REORDERING_PASSED=!0),a[e]=f}0<d&&(a.creation_time=(new Date).getTime(),localStorage.section_scores=JSON.stringify(a));
P13N.MIN_SCORE_FOR_REORDERING_PASSED||(1==localStorage.user_is_participating_in_p13n?localStorage.user_is_participating_in_p13n=0:isInControlGroup&&(isInControlGroup=!1));P13N.debug("section scores: "+JSON.stringify(a));return a};
P13N.reordering.getUserPreferences=function(){for(var b=localStorage.impressions?JSON.parse(localStorage.impressions):[],a={},c=0;c<b.length;c++){var d=P13N.reordering.Impression.fromString(b[c]);a[d.section]||(a[d.section]=[]);a[d.section].push(d)}c={};for(var f in a)a.hasOwnProperty(f)&&(P13N.reordering.getSection(f),c[f]=a[f].length);a=[];for(var e in c)a.push([e,c[e]]);a.sort(function(g,h){return g[1]-h[1]});f=[];for(c=0;c<Math.min(a.length,3);c++)e=a[c],f.push(e[0]);return f.toString()};
P13N.reordering.Impression=function(b,a,c){var d=a;return{start_time:b,length_of_stay:d,section:c,finish_impression:function(){d=(new Date).getTime()-b},toString:function(){var f=b.toString(),e=d.toString();f=3<f.length?f.substr(0,f.length-3):"0";e=3<e.length?e.substr(0,e.length-3):"0";return f+":"+e+":"+c}}};P13N.reordering.Impression.fromString=function(b){b=b.split(":");return new P13N.reordering.Impression(b[0]+"000",b[1]+"000",b[2])};
P13N.reordering.start_impression=function(){P13N.debug("Launching!");var b=(new Date).getTime(),a=document.querySelectorAll("meta[property='article:section']"),c="";a&&0<a.length&&(c=document.querySelectorAll("meta[property='article:section']")[0].content,P13N.debug("found section data:"));0<c.length&&(P13N.reordering.current_impression=new P13N.reordering.Impression(b,0,c))};
P13N.reordering.save_impressions=function(){var b=localStorage.lastSavedUrl?localStorage.lastSavedUrl:"",a=localStorage.lastSavedUrlTime?localStorage.lastSavedUrlTime:0,c=(new Date).getTime();if(p13nurl===b&&-1===p13nurl.indexOf("mako.co.il/p13n_sat_frame.html")&&c-a<P13N.SESSION_TIME)localStorage.lastSavedUrlTime=c;else{localStorage.lastSavedUrl=p13nurl;localStorage.lastSavedUrlTime=c;b=localStorage.impressions?JSON.parse(localStorage.impressions):[];"[object Array]"!==Object.prototype.toString.call(b)&&
(b=JSON.parse(b));0==b.length&&(b=P13N.reordering.get_old_impressions());P13N.reordering.current_impression&&-1<P13N.reordering.current_impression.length_of_stay&&b.push(P13N.reordering.current_impression.toString());a=[];for(var d=0;d<b.length&&!(a.length>P13N.MAX_NUMBER_OF_ITEMS_TO_SAVE);d++){c=b[d].split(":");var f=1E3*parseInt(c[0]);c=(new Date).getTime();c-f<=P13N.NUMBER_OF_DAYS_TO_SAVE_DATA*P13N.DAY&&a.push(b[d])}localStorage.impressions=window.Prototype?a.toJSON():JSON.stringify(a)}};
P13N.reordering.get_old_impressions=function(){P13N.debug("converting old style impressions");for(var b=[],a=0;a<localStorage.length;a++){var c=localStorage.key(a),d=localStorage.getItem(c);if(P13N.reordering.getSection(c)){d=JSON.parse(d);for(var f=0;f<d.points;f++){var e=new P13N.reordering.Impression(d.lastActivity.toString(),60,c);b.push(e.toString())}}}return b};
P13N.reordering.getSection=function(b){for(var a=0;a<P13N.reordering.sections.length;a++){var c=P13N.reordering.sections[a];if(c.name==b)return c}return null};P13N.reordering.finish_impression=function(){P13N.debug("finish_impression");P13N.reordering.current_impression&&P13N.reordering.current_impression.section&&0<P13N.reordering.current_impression.section.length&&(P13N.reordering.current_impression.finish_impression(),P13N.reordering.save_impressions())};
P13N.reordering.call_ios=function(b){var a=document.createElement("IFRAME");a.setAttribute("src","js-frame:"+b);document.documentElement.appendChild(a);a.parentNode.removeChild(a)};
P13N.shouldRequestRating=function(){var b=(new Date).getTime(),a=localStorage.impressions?JSON.parse(localStorage.impressions):[];"[object Array]"!==Object.prototype.toString.call(a)&&(a=JSON.parse(a));for(var c=0,d=0,f=0;f<a.length;f++){var e=P13N.reordering.Impression.fromString(a[f]);e.start_time>b-7*P13N.DAY&&c++;e.start_time>b-P13N.HOUR&&d++}return 12<=c&&3<=d?"true":"false"};
function sendUsageData(){var b=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.open("POST","p13nLocalStorageData.json",!0);b.setRequestHeader("Accept-Encoding","UTF-8");b.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=UTF-8");b.acceptCharset="UTF-8";var a=new FormData,c;for(c in localStorage)a.append(c,localStorage[c]);b.send(a)}
function p13n_test_load(){if("mobileappint"==p13nsubdomain||"mobileapp"==p13nsubdomain||"mobile"==p13nsubdomain||"mobileint"==p13nsubdomain||"www"==p13nsubdomain||"int"==p13nsubdomain||"tabletappint"==p13nsubdomain||"tabletapp"==p13nsubdomain)try{var b=document.querySelectorAll("meta[property='article:section']");b&&0<b.length&&document.getElementsByTagName("Body")[0]?(P13N.reordering.start_impression(),P13N.reordering.finish_impression(),P13N.debug(localStorage.impressions.split(",").join(", "))):
/loaded|complete/.test(document.readyState)?(P13N.reordering.start_impression(),P13N.reordering.finish_impression(),P13N.debug(localStorage.impressions)):setTimeout(function(){p13n_test_load()},500)}catch(a){}}try{p13n_test_load()}catch(b){};